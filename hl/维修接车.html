<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>维修接车</title>
	</head>

	<body>
		<div id="wxjc" style="background-color:  #efeff7; height: 630px; width: 1200px; padding: 10px; margin-left: 100px;">
			<el-tabs v-model="activeName" @tab-click="handleClick">
				<el-tab-pane label="站内维修" name="first">
					<!--
                    	作者：1170546521@qq.com
                    	时间：2020-08-01
                    	描述：站内维修
                    -->
					<el-form :model="weixiujl" :rules="rules" ref="weixiujl" label-width="100px" class="demo-weixiujl">
						<el-row>
							<el-col :span="6"  :offset="3">
								<el-form-item label="维修编码" prop="weixiujlbm">
									<el-input v-model="weixiujl.weixiujlbm" :disabled="true" style="width: 200px;"></el-input>
								</el-form-item>
							</el-col>
							<el-col :span="6">
								<el-form-item label="选择技工">
									<el-select v-model="weixiujl.weixiuzrr" placeholder="请选择技工">
										<el-option v-for="val in staff" :key="val.staffname" :value="val.staffname" :label="val.staffname" />
									</el-select>
								</el-form-item>
							</el-col>
							<el-col :span="6">
								<el-form-item label="车辆品牌">
									<el-autocomplete popper-class="my-autocomplete" v-model="sname" :fetch-suggestions="querySearchAsync" placeholder="输入车牌编号" @select="handleSelect" @Blur="demo()">
										<template slot-scope="props">
											<div class="name">
												{{ props.item.jiescph }}
											</div>
										</template>
									</el-autocomplete>
								</el-form-item>
							</el-col>
						</el-row>
						<el-row>
							<el-col :span="6" :offset="3">
								<el-form-item label="车辆主人">
									<el-input v-model="weixiujl.clzr" :disabled="disabled" style="width: 200px;"></el-input>
								</el-form-item>
							</el-col>
							<el-col :span="6">
								<el-form-item label="车辆驾驶员">
									<el-input v-model="weixiujl.cljsy" :disabled="disabled" style="width: 220px;"></el-input>
								</el-form-item>
							</el-col>
							<el-col :span="6" >
								<el-form-item label="车辆品牌">
									<el-input v-model="weixiujl.clpp" :disabled="disabled" style="width: 200px;"></el-input>
								</el-form-item>
							</el-col>
						</el-row>

						<el-row>
							<el-col :span="6" :offset="3">
								<el-form-item label="备注">
									<el-input type="textarea" v-model="weixiujl.weixiujlbz"></el-input>
								</el-form-item>
							</el-col>
							<el-col :span="6">
								<el-form-item>
									<el-button type="primary" @click="xinzengweixiujilu">立即创建</el-button>
								</el-form-item>
							</el-col>
						</el-row>
						<el-row>
							<el-col :span="15" :offset="5" style="box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1); padding: 10px;">
								<template>
									<el-table :data="Weixiusp" show-summary border style="width: 100%">
										<el-table-column fixed label="单号">
											<!--作用域插槽-->
											<template slot-scope="temp">
												{{temp.$index+1}}
											</template>
										</el-table-column>
										<el-table-column prop="weixiuspname" label="项目名称">
										</el-table-column>
										<el-table-column prop="weixiuspbzpice" label="价格">
										</el-table-column>
										<el-table-column fixed="right" label="操作">
											<template slot-scope="scope">
												<el-button @click="deletesp(scope.row)" type="text" size="small">删除</el-button>
											</template>
										</el-table-column>
									</el-table>
								</template>
							</el-col>
						</el-row>

						<el-row style="margin: 20px; 0px;">
							<el-col :span="24">
								<el-button type="primary" @click="centerDialogVisib" style="margin-left: 300px;">新增维修商品</el-button>

								<el-button type="success" style="margin-left: 100px;">创建维修订单</el-button>

								<el-dialog title="维修商品类型" :visible.sync="centerDialogVisible" width="70%" center>
									<span>
									<el-row class="tac" style=" box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)">
  								<el-col :span="4">
    											<el-menu default-active="2" class="el-menu-vertical-demo" @open="handleOpen" @close="handleClose">
    											<el-submenu index="1">
        										<template slot="title">
          										<i class="el-icon-location"></i>
          								<span>导航一</span>
									</template>
									<el-menu-item-group>
										<template slot="title">分组一</template>
										<el-menu-item index="1-1">选项1</el-menu-item>
										<el-menu-item index="1-2">选项2</el-menu-item>
									</el-menu-item-group>
									<el-menu-item-group title="分组2">
										<el-menu-item index="1-3">选项3</el-menu-item>
									</el-menu-item-group>
									<el-submenu index="1-4">
										<template slot="title">选项4</template>
										<el-menu-item index="1-4-1">选项1</el-menu-item>
									</el-submenu>
									</el-submenu>
									<el-menu-item index="2">
										<i class="el-icon-menu"></i>
										<span slot="title">导航二</span>
									</el-menu-item>
									<el-menu-item index="3" disabled>
										<i class="el-icon-document"></i>
										<span slot="title">导航三</span>
									</el-menu-item>
									<el-menu-item index="4">
										<i class="el-icon-setting"></i>
										<span slot="title">导航四</span>
									</el-menu-item>
									</el-menu>
							</el-col>

							<el-col :span="20" >
								<template>
									<el-table :data="tableData.filter(data => !search || data.name.toLowerCase().includes(search.toLowerCase()))" style="width: 100%">
										<el-table-column label="Date" prop="date">
										</el-table-column>
										<el-table-column label="Name" prop="name">
										</el-table-column>
										<el-table-column align="right">
											<template slot="header" slot-scope="scope">
												<el-input v-model="search" size="mini" placeholder="输入关键字搜索" />
											</template>
											<template slot-scope="scope">
												<el-button size="mini" @click="handleEdit(scope.$index, scope.row)">Edit</el-button>
												<el-button size="mini" type="danger" @click="handleDelete(scope.$index, scope.row)">Delete</el-button>
											</template>
										</el-table-column>
									</el-table>
								</template>
							</el-col>

						</el-row>
						</span>
						<span slot="footer" class="dialog-footer">
    									<el-button @click="centerDialogVisible = false">取 消</el-button>
    									<el-button type="primary" @click="centerDialogVisible = false">确 定</el-button>
  									</span>
						</el-dialog>
						</el-col>
						</el-row>
					</el-form>
				</el-tab-pane>
				<el-tab-pane label="站外维修" name="second">站外维修</el-tab-pane>
			</el-tabs>
		</div>
	</body>

	<script>
		var vmwxjc = new Vue({
			data: {
				//tabs切换
				activeName: 'first',
				//维修记录
				weixiujl: {
					khclid: '',
					weixiujlbm: '',
					weixiujlname: '',
					weixiujlpice: '',
					weixiujlhyj: '',
					weixiujlvipj: '',
					weixiujlxyj: '',
					weixiujlbz: '',
					weixiujlzt: '',
					weixiujlfg: '',
					weixiuzrr: '',
					weixiucfje: '',
					weixiucgcs: '',
					weixiutype: '',
					weixiulic: '',
					weixiujg: '',
					starttime: '',
					endstart: '',
					clzr: '',
					cljsy: '',
					clpp: '',
				},
				//选择技工
				staff: [],
				//模糊查询车牌好
				sname: '',
				rules: {
					name: [{
							required: true,
							message: '请输入活动名称',
							trigger: 'blur'
						},
						{
							min: 3,
							max: 5,
							message: '长度在 3 到 5 个字符',
							trigger: 'blur'
						}
					],
					region: [{
						required: true,
						message: '请选择活动区域',
						trigger: 'change'
					}],
					date1: [{
						type: 'date',
						required: true,
						message: '请选择日期',
						trigger: 'change'
					}],
					date2: [{
						type: 'date',
						required: true,
						message: '请选择时间',
						trigger: 'change'
					}],
					type: [{
						type: 'array',
						required: true,
						message: '请至少选择一个活动性质',
						trigger: 'change'
					}],
					resource: [{
						required: true,
						message: '请选择活动资源',
						trigger: 'change'
					}],
					desc: [{
						required: true,
						message: '请填写活动形式',
						trigger: 'blur'
					}]
				},
				Kehu: {},
				Khcl: {},
				//禁用状态
				disabled: true,
				//维修消耗商品
				Weixiusp: [],
				//对话框状态
				centerDialogVisible: false,
				//维修项目
				wxxm: [],
				//临时表单数组
				tableData: [{
					date: '2016-05-02',
					name: '王小虎',
					address: '上海市普陀区金沙江路 1518 弄'
				}, {
					date: '2016-05-04',
					name: '王小虎',
					address: '上海市普陀区金沙江路 1517 弄'
				}, {
					date: '2016-05-01',
					name: '王小虎',
					address: '上海市普陀区金沙江路 1519 弄'
				}],
				search: ''
			},
			mounted() {
				let _this = this;
				//自动生成时间戳方法
				_this.timechuo();
				//查询员工方法
				_this.selecstaff();
			},
			methods: {
				//tabs的切换方法
				handleClick(tab, event) {
					console.log(tab, event);
				},
				// 表单方法
				submitForm(formName) {
					this.$refs[formName].validate((valid) => {
						if(valid) {
							alert('submit!');
						} else {
							console.log('error submit!!');
							return false;
						}
					});
				},
				resetForm(formName) {
					this.$refs[formName].resetFields();
					let _this = this;
					_this.timechuo();
				},
				//自动生成时间戳方法
				timechuo() {
					let _this = this;
					var time = Math.round(new Date() / 1000);
					new Date(parseInt(time * 1000)).toLocaleDateString();
					_this.weixiujl.weixiujlbm = time;
				},
				//查询员工方法
				selecstaff() {
					let _this = this;
					$.getJSON('http://127.0.0.1:9999/api/hl/selecBybzjg', function(staff) {
						_this.staff = staff;

					});
				},
				querySearchAsync(queryString, cb) {
					var sr = [];
					let _this = this;
					if(queryString != undefined && queryString.length > 0) {
						$.getJSON('http://127.0.0.1:9999/api/hl/select1/' + queryString + '', function(khcl) {
							cb(khcl);
							if(khcl != '') {
								_this.disabled = true;
							} else {
								_this.disabled = false;
							}
						});
					} else {
						cb(sr);
					}
				},
				handleSelect(item) {
					alert(item);
					this.sname = item.jiescph;
					let _this = this;
					_this.weixiujl.khclid = item.khclid;
					$.getJSON('http://127.0.0.1:9999/api/hl/selectByPrimaryKey2/' + item.kehuid + '', function(Kehu) {
						_this.Kehu = Kehu;
						_this.weixiujl.clzr = _this.Kehu.kehumc;
					});
					$.getJSON('http://127.0.0.1:9999/api/hl/selectByPrimaryKey1/' + item.khclid + '', function(Khcl) {
						_this.Khcl = Khcl;
						_this.weixiujl.cljsy = _this.Khcl.khcljsy;
						_this.weixiujl.clpp = _this.Khcl.khclpp;
					});
				},
				xinzengweixiujilu() {
					let _this = this;
					$.getJSON('http://127.0.0.1:9999/api/hl/selecBystaff/' + _this.weixiujl.weixiuzrr + '', function(staff) {
						var obj = {};
						obj['weixiuspname'] = '技工费';
						obj['weixiuspbzpice'] = staff.xjfei;
						_this.Weixiusp.push(obj);
						alert(JSON.stringify(_this.Weixiusp));
						/*_this.Weixiusp = Weixiusp;*/
					});

					_this.Weixiusp.push();
				}, //打开新增维修商品 and 模糊查询维修项目
				centerDialogVisib() {
					let _this = this;
					_this.centerDialogVisible = true;
					$.getJSON("http://127.0.0.1:9999/api/hl/selectByP", "wxxmname=" + _this.wxxmname + "", function(clpp) {
						_this.wxxm = clpp;
						alert(JSON.stringify(_this.wxxm));
					});
				},
				//临时表单查询方法
				handleEdit(index, row) {
					console.log(index, row);
				},
				handleDelete(index, row) {
					console.log(index, row);
				}
			}
		}).$mount("#wxjc");
	</script>

</html>